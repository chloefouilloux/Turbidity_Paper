---
title: "LAS Turbidity"
author: "Chloe Fouilloux"
date: '2022-08-04'
output: html_document
---

Hello friends, 

Today we will be playing around with our turbitidy dataset from La Selva, Costa Rica. Let's jump right in with downloading some pacakages. 

```{r pacakges}
library(dplyr)
library(ggplot2)
library(gghighlight)
library(ggtext)
library(gridExtra)
library(tidyverse)
library(forcats)
library(readr)
library(glmmTMB)
library(DHARMa)
library(lme4)
library(MASS)
library(sjPlot)

```

Theme Set

```{r ggplot custom theme}
theme_set(  theme(legend.position = "right",
                  strip.background = element_rect(fill = "White"),
                  panel.background = element_rect(fill = "white",
                                                  colour = "black"), 
                  panel.grid.major = element_line(size = 0), 
                  panel.grid.minor = element_line(size = 0), 
                  text = element_text(size = 14)))
```

Now, let's load some data

```{r}
#las<- read_csv("LAS_VISION.csv") #without spectral data
#las<- read_csv("LAS_VISION_AUG2022.csv") #spectral data from AUG. 22 2022 code-a-thon
las<- read_csv("LAS_VISION_OCT2022.csv")

las <- las %>%
       mutate(Trial = as.factor(Trial),
              Tad_ID = as.factor(Tad_ID),
              Condition = as.factor(Condition),
              Predator = as.factor(Predator)) 
#activity
activity <- las %>%
           filter (Condition != "Background") %>%
           dplyr::select(! c("White", "Black")) %>%
           mutate(mass_diff_cons = Mass - Cons_g, 
                  pr_z1 = Zone_1/60, 
                  pr_swim = Swim/60)

activity$Predator<- forcats::fct_relevel(activity$Predator, 
                    c("Control", "Spider", "Conspecific"))

#Lets also look for black and white background trial
#background choice data
bw_choice_las <- las %>%
            filter (Condition == "Background") %>%
            mutate(p_black = Black/60, 
                   p_swim = Swim/60) 

```

#### Statistics, yo 

```{r Time spent on Black background}

############################
  ##### MEAN WAVE #####
############################
#* CONSLUSION NOTHING MATTERS *

#Should look at Mean_Wave in addition to rMean_OG

m1<- glm(p_black ~ Mass + (Mean_Wave), #+ (1 | Tad_ID)
             data = bw_choice_las, family = binomial) 

m1a<- glm(Black ~ Mass + (Mean_Wave), #+ (1 | Tad_ID)
             data = bw_choice_las, family = poisson) 


m1b<- glm.nb(Black ~ Mass + (Mean_Wave), #+ (1 | Tad_ID)
             data = bw_choice_las) 

AIC(m1, m1a, m1b)
summary(m1)
simulationOutput <- simulateResiduals(fittedModel = m1)
plot(simulationOutput)

testDispersion(m1)
testZeroInflation(m1)


############################
  ##### %R channel reflectance #####
############################
#* CONSLUSION NOTHING MATTERS *

m0G1<- glm(p_black ~ Mass + log(rMean_OG), #+ (1 | Tad_ID)
             data = bw_choice_las, family = binomial) 

mOG1<- glm(Black ~ Mass + log(rMean_OG), #+ (1 | Tad_ID)
             data = bw_choice_las, family = poisson) 


mOG1<- glm.nb(Black ~ Mass + log(rMean_OG), #+ (1 | Tad_ID)
             data = bw_choice_las) 


summary(m0G1)
simulationOutput <- simulateResiduals(fittedModel = mOG1)
plot(simulationOutput)

testDispersion(m1)
testZeroInflation(m1)





```


```{r Zone 1 Useage}

############################
  ##### MEAN WAVE #####
############################

# CONCLUSION: #SIG ConditionWhite:PredatorConspecific:Mean_Wave
#Not bad on ConditionWhite:PredatorConspecific

m2<- glmmTMB(Zone_1 ~ Condition * Predator * (Mean_Wave) + #log(rMean_OG)
                (Mass)+
                #offset((Mass)) +
               (1|Tad_ID), 
              data = activity, family = nbinom1) 
# ziformula = ~ log(rMean_OG) #gaussian, nbinom1/2

summary(m2)
simulationOutput <- simulateResiduals(fittedModel = m2)
plot(simulationOutput)

step(m2) #Keep 3-way interaction? I guess so!

#only white
m2a<- glmmTMB(Zone_1 ~ 
                Condition * Predator + Mean_Wave + #log(rMean_OG)
                Mass+
                #offset((Mass)) +
               (1|Tad_ID), 
              data = activity, family = nbinom1) 
# ziformula = ~ log(rMean_OG) #gaussian, nbinom1/2
summary(m2b)

#nothing
m2b<- glmmTMB(Zone_1 ~ 
                Condition + Predator * Mean_Wave + #log(rMean_OG)
                Mass+
                #offset((Mass)) +
               (1|Tad_ID), 
              data = activity, family = nbinom1) 

#nothing in m2c
m2c<- glmmTMB(Zone_1 ~ 
                Condition * Mean_Wave  + Predator + #log(rMean_OG)
                Mass+
                #offset((Mass)) +
               (1|Tad_ID), 
              data = activity, family = nbinom1) 
summary(m2c)

m2d<- glmmTMB(Zone_1 ~ 
                Condition + Mean_Wave  + Predator + #log(rMean_OG)
                Mass+
                #offset((Mass)) +
               (1|Tad_ID), 
              data = activity, family = nbinom1) 

summary(m2d)
simulationOutput <- simulateResiduals(fittedModel = m2d)
plot(simulationOutput)

anova(m2, m2a)
anova(m2, m2b)
anova(m2, m2d) #okay go for m2d then

testDispersion(m2d)
testZeroInflation(m2d)

############################
  ##### r MEAN OG #####
############################ 

#no interactions here are significant, 
#only WHITE CONDITION drives zone 1 use.
#same results under R, B, AND G. 

#TROUBLESHOOTING: nbinom2, log(mass), unlog rmean, poisson

m2_rMean<- glmmTMB(Zone_1 ~ 
                Condition + log(rMean_OG)  + Predator + #Mean_Wave +
                log(Mass)+
               (1|Tad_ID), 
              data = activity, family = nbinom1) 

summary(m2_rMean)
simulationOutput <- simulateResiduals(fittedModel = m2_rMean)
plot(simulationOutput)

#tab model
tab_model(m2_rMean, 
          transform = NULL,
          show.ci = F, 
          show.est = T, 
          show.se = T, 
          show.stat = T,
          show.obs = F,
          show.r2 = F,
          string.stat = "z value",
          string.se = "SE", 
          dv.labels = "<i>O. pumilio</i> Space-use (zone 1 counts)",
          pred.labels = c("(Intercept)",
                         "Condition [White]",
                         "log(% R-ch reflectance)",
                        "Predator [Spider]",
                         "Predator [Cons.]", 
                         "Mass"))


```


```{r Activity}


############################
  ##### MEAN WAVE #####
############################ 

m3<- glmmTMB(Swim ~ 
                Condition * Predator * (Mean_Wave) + #log(rMean_OG)
                (Mass)+
                #offset((Mass)) +
               (1|Tad_ID), 
              data = activity, family = nbinom1) 
# ziformula = ~ log(rMean_OG) #gaussian, nbinom1/2

summary(m3)
step(m3)

m3a<- glmmTMB(Swim ~ 
                Condition + Predator + Mean_Wave + #log(rMean_OG)
                (Mass)+
                #offset((Mass)) +
               (1|Tad_ID), 
              data = activity, family = nbinom1) 

m3b<- glmmTMB(Swim ~ 
                Condition * Predator + Mean_Wave + #log(rMean_OG)
                (Mass)+
                #offset((Mass)) +
               (1|Tad_ID), 
              data = activity, family = nbinom1) 


m3c<- glmmTMB(Swim ~ 
                Condition + Predator * Mean_Wave + #log(rMean_OG)
                (Mass)+
                #offset((Mass)) +
               (1|Tad_ID), 
              data = activity, family = nbinom1) 

m3d<- glmmTMB(Swim ~ 
                Condition * Mean_Wave + Predator + #log(rMean_OG)
                (Mass)+
                #offset((Mass)) +
               (1|Tad_ID), 
              data = activity, family = nbinom1) 
summary(m3d)
simulationOutput <- simulateResiduals(fittedModel = m3d)
plot(simulationOutput)

anova(m3d, m3a)


############################
  ##### r MEAN OG #####
############################ 

#agrees

m3OG<- glmmTMB(Swim ~ 
                Condition * Predator * log(rMean_OG) +
                (Mass)+
                #offset((Mass)) +
               (1|Tad_ID), 
              data = activity, family = nbinom1) 

m3OG<- glmmTMB(Swim ~ 
                Condition * log(rMean_OG) + Predator +
                (Mass)+
                #offset((Mass)) +
               (1|Tad_ID), 
              data = activity, family = nbinom1) 


summary(m3OG)
simulationOutput <- simulateResiduals(fittedModel = m3OG)
plot(simulationOutput)

#Tab Model
tab_model(m3OG, 
          transform = NULL,
          show.ci = F, 
          show.est = T, 
          show.se = T, 
          show.stat = T,
          show.obs = F,
          show.r2 = F,
          string.stat = "z value",
          string.se = "SE", 
          dv.labels = "<i>O. pumilio</i> Activity (swim counts)",
          pred.labels = c("(Intercept)",
                         "Condition [White]",
                         "log(% R-ch reflectance)", 
                         "Predator [Spider]",
                         "Predator [Cons.]", 
                         "Mass", 
                         "Condition [White]: log(% R-ch reflectance)"))

```


#PLOTTING TIME

##B + W choice
First, let's start with the beginning, which is background choice

```{r PLOTTING: B + W Choice}

#White/black preference ####

#With mean wave
ggplot(bw_choice_las, aes(x = Mass, y = p_black))+
  annotate(geom = "rect", 
           fill = "black",
           color = "black",
           alpha = 0.5,
           xmin = -Inf,
           xmax = Inf,
           ymin = 0.5,
           ymax = Inf)+
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "white") + 
  geom_point(size = 3, shape = 21, stroke = 1.5, 
             aes(fill = rMean_OG)) +  #Mean_Wave
  ylab("Prp. spent on black background")+
  xlab("Tadpole mass (g)") + 
  scale_fill_gradient(high = "white", low = "#5c1f27", 
  name = "%R channel reflectance") 

##Black/White Choice with Swimming Activity? ##
ggplot(bw_choice_las, aes(y = Swim, x = Stage))+ #, color = p_black
  geom_point(size = 3)

#White/black preference #### **WITH SPECTRAL DATA**
ggplot(bw_choice_las, aes(x = Mass, y = p_black))+
  annotate(geom = "rect", 
           fill = "black",
           color = "black",
           alpha = 0.5,
           xmin = -Inf,
           xmax = Inf,
           ymin = 0.5,
           ymax = Inf)+
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "white") + 
  geom_point(size = 3, shape = 21, stroke = 1, 
             color = "white", aes(fill = Mean_Wave)) + 
  ylab("Prp. spent on black background")+
  xlab("Tadpole mass (g)") +
  scale_fill_gradient(low = "white", high = "black", 
                      name = "Mean wavelength") + 
  theme(legend.title= element_text(size = 10), 
        legend.text = element_text(size = 10))


#Assumptions check, heavier tadpoles are more developed
ggplot(activity, aes(y = Stage, x = Mass))+ #color = Predator
  geom_point()+ 
  stat_smooth(formula = y~ x, #poly(x,2)
              method = "gam")

```


Right let's see what's going on here

So, for our first Zone 1 plot, it looks like there is no difference in behaviour under dark luminic conditions, but under white conditions there appears to be that tadpoles spend more time in Zone 1, maybe looking at what's inside?

**Notes on Zone 3**

Okay, so generally there seems to be an effect of luminic condition on tadpole placement, where in white conditions they are moving more. This, unfortunately is more a reflection on laboratory conditions and not the biological question being asked.

```{r PLOTTING: Zone 1 + 3 Choice}

#Zone 1 good one emphasizing black vs. white, which was sig. finding
#It might be interesting to add mom here for comparison
ggplot(activity, aes( y = Zone_1, x = Predator , color = Predator)) +   annotate(geom = "rect", 
             xmin = -Inf, xmax = 1.5, 
             ymin = -Inf, ymax = Inf, 
             fill = "lightgreen", 
             alpha = 0.2)+
    geom_jitter(height = 0, width = 0.06, size = 2.4, alpha = 0.5) +
    geom_hline(yintercept = 14.2, linetype = "dashed")+
    stat_summary(fun.data = mean_cl_boot, #lets look at mean instead of median
                 geom = "pointrange", # could also do crossbar, errorbar
                 shape = 21,
                 color = "black",
                 fill = "white",
                 size = 0.8) + 
    facet_wrap(~ Condition) + 
    ylab("Count of Zone 1 choice") +
    xlab("Visual Cue")+
  scale_color_brewer(palette = "Accent") +
  theme(legend.position = "none")

#Zone 1
#It might be interesting to add mom here for comparison
ggplot(activity, aes( y = Zone_1, x = Condition , color = Predator)) +   
    geom_point()+
    stat_summary(fun.data = mean_cl_boot, #lets look at mean instead of median
                 geom = "pointrange", # could also do crossbar, errorbar
                 shape = 21,
                 color = "black",
                 fill = "white",
                 size = 0.8) + 
  facet_wrap(~ Predator) + 
  scale_color_brewer(palette = "Accent") +
  theme(legend.position = "none")


#TRY AGAIN
ggplot(activity, aes( y = Zone_1, x = Mass , color = Condition)) +  
    geom_point() +
    stat_smooth(method = "gam")+
    facet_wrap(~ Predator) + 
    ylab("Count of Zone 1 choice") +
    xlab("Mass")+
  scale_color_brewer(palette = "Accent") +
  coord_cartesian(ylim = c(0,60))
  
#Zone 3
ggplot(activity, aes( y = Zone_3, x = Predator , color = Predator)) +
      annotate(geom = "rect", 
             xmin = -Inf, xmax = 1.5, 
             ymin = -Inf, ymax = Inf, 
             fill = "lightgreen", 
             alpha = 0.2)+
    geom_jitter(height = 0, width = 0.06, size = 2.4, alpha = 0.5) +
    geom_hline(yintercept = 18.2, linetype = "dashed")+
    stat_summary(fun.data = mean_cl_boot, #lets look at mean instead of median
                 geom = "pointrange", # could also do crossbar, errorbar
                 shape = 21,
                 color = "black",
                 fill = "white",
                 size = 0.8) + 
    facet_wrap(~ Condition) + 
    ylab("Count of Zone 3 choice") +
    xlab("Visual Cue")+
  scale_color_brewer(palette = "Accent") +
  theme(legend.position = "none")

```


```{r Zone 1 with Spectral Data}

## ** favourite ** ##

## MEAN WAVELENGTH AND POOL CHOICE FACET BY PREDATOR
ggplot(activity, aes( y = pr_z1, x = Predator, colour = Predator)) + 
annotate(geom = "rect", 
             xmin = -Inf, xmax = 1.5, 
             ymin = -Inf, ymax = Inf, 
             fill = "lightgreen", 
             alpha = 0.2)+
geom_jitter(size = 3,stroke = 1, alpha = 0.3, 
            height = 0, width = 0.08) +
  geom_rect( data = data.frame(Condition = "Black"),
            aes(ymin = 0.35, ymax = 0.55, xmin = -Inf, xmax = Inf), 
            inherit.aes = F, fill = "lightgrey", colour = "black", 
            alpha = 0.4, linetype = "dashed", size = 0.2) + 
 geom_rect( data = data.frame(Condition = "White"),
            aes(ymin = 0.15, ymax = 0.35, xmin = -Inf, xmax = Inf), 
            inherit.aes = F, fill = "lightgrey", colour = "black", 
            alpha = 0.4, linetype = "dashed", size = 0.2) + 
facet_wrap(~ Condition)+
  stat_summary(fun.data = mean_cl_boot, #lets look at mean instead of median
                 geom = "pointrange", # could also do crossbar, errorbar
                 shape = 21,
                 stroke = 1.5,
                 color = "black",
                 fill = "white",
                 size = 0.8) +
ylab("Proportion spent in zone 1") +
scale_color_brewer(palette = "Accent")+
coord_cartesian(ylim = c(0,1)) + 
theme(legend.position = "None")


##### IT IS WORTH SHOWING THE 3-WAY INTERACTION FOR CONSPECIFIC VISUAL IDENTIFICATION #####
  
## MEAN WAVELENGTH AND POOL CHOICE FACETED BY CONDITION
ggplot(activity, aes(y = pr_z1, x = rMean_OG , color = Predator)) + #Mean_wave  
geom_point(size = 2, shape = 21, stroke = 1)+
    facet_wrap(~ Condition + Predator) +
    stat_smooth(method = "gam", 
                formula = y ~ s(x, bs = "cs"), 
                aes(fill = Predator), 
                alpha = 0.2)+ #y ~ s(x, bs = "cs"), log(x)
    ylab("Proportion spent in Zone 1") +
    xlab("% R-channel Reflectance") + 
    scale_color_brewer(palette = "Accent") +
    scale_fill_brewer(palette = "Accent") +
    coord_cartesian(ylim = c(0,1)) + 
  theme(legend.position = "None")

### Since removed
## MEAN WAVELENGTH AND POOL CHOICE FACET BY PREDATOR
ggplot(activity, aes( y = Zone_1, x = Mean_Wave)) +   
geom_point(size = 3, shape = 21, stroke = 1, 
           aes(fill = Mean_Wave)) +
stat_smooth(aes(colour = Condition), 
            method = "gam", 
            formula = y ~ s(x, bs = "cs"), #y ~ s(x, bs = "cs"), log(x)
            fill = "grey")+
scale_fill_gradient(low = "white", high = "#5c1f27", 
                    name = "Mean wavelength") +
facet_wrap(~ Predator)+
ylab("Count of Zone 1 choice") +
xlab("Pool mean wavelength") + 
scale_color_manual(values = c("Black", "White"), 
                   name = "Luminic condition")+
#scale_color_brewer(palette = "Accent")+
coord_cartesian(ylim = c(0,60))

```



Doesn't really seem to be much difference in swimming activity.
EXCEPT:
We do see that when the size difference is greater between tadpoles and the focal tadpole is on the small side that these tadpoles are more active. This would seem to suggest that tadpoles are taking into account the differences in size and responding differently to differently sized predators.
```{r PLOTTING: Activity}
  
#MOST INTERESTING ONE
#Swimming activity
ggplot(activity, aes( y = Swim, x = Mass , color = Condition)) +
    geom_point(size = 3, alpha = 0.3) +
    stat_smooth(method = "gam", 
                formula = y ~ s(x, bs = "cs"), 
                fill = "lightgrey")+ 
    facet_wrap(~Predator ) + #Condition
    ylab("Swim activity") +
  scale_color_brewer(palette = "Accent") +
  coord_cartesian(ylim = c(0,45))

#Swimming activity
ggplot(activity, aes( y = Swim, x = Predator , color = Predator)) +
      annotate(geom = "rect", 
             xmin = -Inf, xmax = 1.5, 
             ymin = -Inf, ymax = Inf, 
             fill = "lightgreen", 
             alpha = 0.2)+
    geom_jitter(height = 0, width = 0.06, size = 2.4, alpha = 0.5) +
    geom_hline(yintercept = 9.2, linetype = "dashed")+
    stat_summary(fun.data = mean_cl_boot, #lets look at mean instead of median
                 geom = "pointrange", # could also do crossbar, errorbar
                 shape = 21,
                 color = "black",
                 fill = "white",
                 size = 0.8) + 
    facet_wrap(~ Condition) + 
    ylab("Swim activity") +
    xlab("Visual Cue")+
  scale_color_brewer(palette = "Accent") +
  theme(legend.position = "none")

###

#Activity generally is lower the more time the tadpole spends in the center, this does not differ from controls.

ggplot(activity, aes(x = Zone_1, y = Swim))+ #color = Predator
  geom_point()+ 
  stat_smooth(formula = y~ x, #poly(x,2)
              method = "gam")+
      facet_wrap(~ Condition)

## CONSPECIFIC ACTIVITY RESPONSE ####

ggplot(subset(activity, Predator %in% c("Conspecific")), 
       aes( y = Swim, x = mass_diff_cons)) +
  geom_vline(xintercept = 0, color = "lightgrey",
             linetype = "dashed")+
  geom_point(size = 3, alpha = 0.2, shape = 21)+  
  #geom_hline(yintercept = 9.2, linetype = "dashed")+
    facet_wrap(~ Condition) + 
    ylab("Swim activity") +
  stat_smooth(formula = y ~ x, 
              method = "gam", 
              color = "black")+
  xlab("Mass difference (Focal - Center)")+
  geom_text(aes(x = 0.03, y =40), 
            color = "black", label = "Focal larger", 
            check_overlap = T, size = 3.5)+ 
   geom_text(aes(x = -0.06, y =40), 
            color = "black", label = "Focal smaller", 
            check_overlap = T, size = 3.5)+ 
  theme(legend.position = "none") + 
  coord_cartesian(ylim = c(0, 40))


```

#### SWIM AND SPECTRAL ####

Point (1) Pool wave + range does not affect tadpole swimming activity in response to different predators
Point (2) Pool wave + range does not affect tadpole swimming activity under differnet luminic conditions
Point (3) Pool wave + range does not affect tadpole swimming activity, genereally.


```{r PLOTTING: SWIM AND SPECTRAL}

#Swimming activity FACETED BY CONDITION
pum_swim<-
ggplot(activity, aes( y = pr_swim, x = rMean_OG)) + #Mean_Wave
geom_point(size = 3, shape = 21, stroke = 1, 
           aes(fill = rMean_OG), alpha = 0.7) + #Mean_Wave
    facet_wrap(~ Condition) +
     stat_smooth(method = "gam", 
               formula = y ~ x, 
                aes(colour = Predator), 
               alpha = 0.1, 
               linetype = "dashed",
               size = 0.5,
               fill = NA)+
       stat_smooth(method = "gam", 
               formula = y ~ poly(x,1), #log(x) 
               color = "black", 
               size = 1, 
               fullrange = T)+
  ylab("Proportion of time spent swimming") +
   xlab("% R-channel reflectance") + 
  #expression(Nursery~mean~wavelength~Delta * tilde(nu)/cm^-1)
 scale_fill_gradient(high = "white", low = "#5c1f27", 
                    name = "%R channel reflectance") +
  #expression(Delta * tilde(nu)/cm^-1)
geom_richtext(data = data.frame(Condition = "White"),
     aes(x = 42, y =0.25), color = "black", 
     label = "Light nursery tadpoles swim<br>**more** in white conditions", size = 3)+
geom_richtext(data = data.frame(Condition = "White"),
     aes(x = 20, y = 0.03), color = "black", 
     label = "Dark nursery tadpoles swim<br>**less** in white conditions", size = 3)+
coord_cartesian(ylim = c(0, 1))+
scale_color_brewer(palette = "Accent") + 
theme(legend.text = element_text(size = 10), 
        legend.title = element_text(size = 10)) + 
  labs(tag = "A")

pum_swim

#As a result of model output

#Swimming activity FACETED BY CONDITION
pum_mass<- 
ggplot(activity, aes( y = pr_swim , x = Mass)) +
geom_point(size = 3, shape = 21, stroke = 1, alpha = 0.6, 
           fill = "lightblue") +
       stat_smooth(method = "glm", 
               formula = y ~ (x), 
               color = "black", 
               size = 1)+
         stat_smooth(method = "gam", 
               geom = "ribbon",
               linetype = "dashed",
               colour = "black",
               fill = NA,
               formula = y ~ x)+
    ylab("Proportion of time spent swimming") +
   xlab("Focal tadpole mass (g)") +
   labs(tag = "B") + 
  coord_cartesian(ylim = c(0,1))

pum_mass

grid.arrange(pum_swim, pum_mass, heights = c(0.60, 0.40))

################################################################################

#Swimming activity FACETED BY PREDATOR
ggplot(activity, aes( y = Swim, x = Mean_Wave , color = Condition)) +
    geom_point(size = 3, alpha = 0.3) +
    stat_smooth(method = "gam", 
                formula = y ~ s(x, bs = "cs"), 
                fill = "lightgrey")+ 
    facet_wrap(~Predator ) + #Condition
    ylab("Swim activity") +
  scale_color_brewer(palette = "Accent") +
  coord_cartesian(ylim = c(0,45))

  
  #
  ggplot(activity, aes(x = Mean_Wave, y = Swim))+ #color = Predator
    geom_point(size = 2, shape = 21, stroke = 1, alpha = 0.6,
               aes(color = Predator))+
  stat_smooth(formula = y ~ x, #poly(x,2), log(x), y ~ s(x, bs = "cs")
              method = "gam", 
              color = "black")+
      facet_wrap(~ Condition)+
        ylab("Swim activity") +
  scale_color_brewer(palette = "Accent") +
   xlab("Mean Pool Wavelength") + 
    scale_color_brewer(palette = "Accent") +
    scale_fill_brewer(palette = "Accent") +
    coord_cartesian(ylim = c(0,45))
  theme(legend.position = "none")
  
  #Pool wave + range does not affect tadpole swimming activity
  ggplot(activity, aes( y = Swim, x = Range_Wave)) +
    geom_point(size = 2, shape = 21, stroke = 1)+
    facet_wrap(~ Condition) +
    stat_smooth(method = "gam", 
                formula = y ~ x, #s(x, bs = "cs") 
             
                alpha = 0.2)+
    ylab("Swim activity") +
  scale_color_brewer(palette = "Accent") +
   xlab("Range Pool Wavelength") + 
    scale_color_brewer(palette = "Accent") +
    scale_fill_brewer(palette = "Accent") +
    coord_cartesian(ylim = c(0,45))
  theme(legend.position = "none")
  
  ## Slight trend? But nothing very convincing.

  ggplot(activity, aes(x = Mean_Wave, y = Mass))+ #color = Predator
    geom_point(size = 2, shape = 21, stroke = 1, alpha = 0.6,
               aes(color = Predator))+
  stat_smooth(formula = y ~ x, #poly(x,2), log(x), y ~ s(x, bs = "cs")
              method = "gam", 
              color = "black")+
      #facet_wrap(~ Condition)+
  scale_color_brewer(palette = "Accent") +
    scale_color_brewer(palette = "Accent") +
    scale_fill_brewer(palette = "Accent") +
  theme(legend.position = "none")


```


#Exploration nation!

The number of times a tadpole switches zones.

```{r Exploration}

#exploration and predator (no) and background (maybe)
ggplot(activity, aes(y = Exploration, x = Condition, 
                     fill = Condition)) + 
  geom_jitter(height = 0, width = 0.08, alpha = 0.2, 
              size = 2.5, shape = 21, color = "black")  +
   stat_summary(fun.data = mean_cl_boot, #lets look at mean instead of median
                 geom = "pointrange", # could also do crossbar, errorbar
                 shape = 21,
                 color = "black",
                 fill = "white",
                 size = 0.8) + 
  #facet_wrap(~ Predator) + 
  stat_smooth(method = "gam", 
              formula = y ~ log(x)) +
  xlab("Background colour")+
  scale_fill_manual(values = c("black", "white"))+
  ylab("Exploration (zone change count)")+
  theme(legend.position = "none")+
  coord_cartesian(ylim = c(0,18))


#exploration and background and mean wave
ggplot(activity, aes(y = Exploration, x = Mean_Wave )) + 
  geom_point()  +
  #facet_wrap(~ Condition) + 
  stat_smooth(method = "gam", 
              formula = y ~ log(x))

#exploration and swimming more (not much)
ggplot(activity, aes(y = Exploration, x = Mass )) + 
  geom_point()  +
  #facet_wrap(~ Predator) + 
  stat_smooth(method = "gam", 
              formula = y ~ (x))

#exploration and swimming more (duh)
ggplot(activity, aes(y = Exploration, x = Swim )) + 
  geom_point()  +
  #facet_wrap(~ Predator) + 
  stat_smooth(method = "gam", 
              formula = y ~ (x))

```







### PHOTOGRAPHY AND COLOUR ###
Alright, as you know we also have these photos that were taken the day that the water samples were collected. With luck, these should also correlate to the turbidity values that we got-- while this isnt super important for the pumilio data it is VITAL for ground truthing the tinctorius data. 


```{r Photography and R channel}

#Red channel analysis validated by Fouilloux et al. 2022 Frontiers in Biology that hypothesized about r-channel and increasingly red/turbid environments.

ggplot(las, aes(x = Mean_Wave, y = rMean_OG)) + 
  geom_point(aes(fill = Mean_Wave), shape = 21, size = 3) + 
  stat_smooth(method = "gam", 
              formula = y ~ log(x), 
              color = "black") +
    #stat_smooth(method = "gam", 
              #formula = y ~ (x), 
             # color = "blue") +
   scale_fill_gradient(low = "white", high = "#5c1f27", 
                    name = "Mean wavelength") +
  ylab("% reflectance relative to standards (R-Channel)") + 
  xlab(expression(Mean~wavelength~Delta * tilde(nu)/cm^-1)) + 
  theme(legend.position = "None")

#it also works for the other channels
#an alternative to this would also be converting these data from an RGB colour space into CIELAB.


```

## Biological Truths ##

```{r}
#We see that larger tadpoles swim less, in general.
#HUOM!We see the same trend for D. tinctorius

ggplot(activity, aes(x = Mass, y = Swim))+
  geom_point() + 
  #facet_wrap(~ Predator)+ #holds for both conditions + predator
  stat_smooth(method = "gam")

#But do we see a bias in nursery turbidity and size?

#Not a great fit, but does look like a bit of a negative correlation?
ggplot(activity, aes(x = Mass, y = Mean_Wave))+
  geom_point(size = 3) + 
  stat_smooth(method = "gam", 
              formula = y~(x)) #log

#We do, however, see a good spread of stages
ggplot(activity, aes(x = Stage, y = Mean_Wave))+
  geom_point(size = 3) + 
  stat_smooth(method = "gam", 
              formula = y~(x)) #log


```

